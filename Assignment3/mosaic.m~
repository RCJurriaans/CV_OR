function imgout = mosaic(varargin)

imtarget = varargin(1);
    w = size(imtarget,2);
    h = size(imtarget,1);
    
corners = [1 1 1; w 1 1; 1 h 1; w h 1]';

A = zeros(3,3,nargin);
A(:,:,1) = eye(3);

% get transformed corners of all images
for i=2:nargin
    % Load next image
    imnew = varargin(i);
    
    % Get transformation A from new image to target
    x = imageAlign(imnew, imtarget);
    A(:,:,i) = [reshape(x(1:4),2,2), x(5:6); 0 0 1];
    
    w = size(imnew,2);
    h = size(imnew,1);
    
    corners = [corners A(:,:,i)*[1 1 1; w 1 1; 1 h 1; w h 1]'];    
end

minx = min(corners(1,:));
maxx = max(corners(1,:));
miny = min(corners(2,:));
maxy = max(corners(2,:));

xoffset = -minx




end





figure;


% Do the transformation
tform = maketform('affine', inv([reshape(x(1:4),2,2) x(5:6) ; 0 0 1])' );
im1b = imtransform(im1,tform, 'bicubic');




end