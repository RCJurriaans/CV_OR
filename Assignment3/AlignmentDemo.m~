% Image Alignment Demo
% Assignment 3.1

% Open Images
im1 = im2double(imread('boat/img1.pgm'));
im2 = im2double(imread('boat/img2.pgm'));

% Find Transformation
[x, match1, match2] = imageAlign(im1,im2);

% Draw images with lines from original points
% to transformed points
figure;
% Original Image
subplot(2,1,1);

imshow([im1 im2]);
hold on;

perm = randperm(size(match1,2));
seed = perm(1:50);
T = [x(1) x(2) x(5);...
     x(3) x(4) x(6);...
     0    0    1   ];
match1t = T*[match1;ones(1, size(match1,2))];

line(match1(:,seed)); size(im1,2)+match1t(1,:)],...
    [f1(2,matches(1,seed)); b2(2,:)]);

title('Image 1 and 2');
% First Image transformed
subplot(2,2,4);

% Do the transformation
tform = maketform('affine', T' ; 0 0 1])' );
im1b = imtransform(im1,tform, 'bicubic');
imshow(im1b);
title('Image 1 transformed to image 2')
% Second Image transformed
subplot(2,2,3);

% Do the transformation
tform = maketform('affine', [reshape(x(1:4),2,2) x(5:6) ; 0 0 1]' );
im2b = imtransform(im2,tform, 'bicubic');
imshow(im2b);
title('Image 2 transformed to image 1')

